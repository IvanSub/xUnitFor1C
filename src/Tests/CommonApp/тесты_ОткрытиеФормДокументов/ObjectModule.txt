Перем _Форма;

Перем	юТест;

Функция ПолучитьСписокТестов(ЮнитТестирование) Экспорт
	юТест = ЮнитТестирование;
	
	ВсеТесты = Новый Массив;

	ДобавитьТестДляМетаданного(ВсеТесты, Метаданные.Документы, "Тест_ОткрытьФормуСуществующегоДокумента", ПолучитьСписокИсключений_Существующие());
	
	// Исключения тут
	//ВсеТесты.Добавить("Тест_ОткрытьФормуСуществующегоВводНачальныхОстатков");
	
	ДобавитьТестДляМетаданного(ВсеТесты, Метаданные.Документы, "Тест_ПеренестиДокументНаТекущийДень_и_ОткрытьЕгоФорму", ПолучитьСписокИсключений_ПеренестиДату());
	
	ДобавитьТестДляМетаданного(ВсеТесты, Метаданные.Документы, "Тест_ОткрытьФормуНовогоДокумента", ПолучитьСписокИсключений_Новые());

	Возврат ВсеТесты;
КонецФункции

Процедура ПослеЗапускаТеста() Экспорт
	Если ТипЗнч(_Форма) <> Тип("Форма") Тогда
		Возврат;
	КонецЕсли; 
	_Форма.Модифицированность = Ложь;
	Если _Форма.Открыта() Тогда
		_Форма.Закрыть();
	КонецЕсли; 
	_Форма = "";
КонецПроцедуры

Процедура ДобавитьТестДляМетаданного(ВсеТесты, менеджерМетаданного, имяТеста, списокИсключений)
	Для Каждого мДокумент Из менеджерМетаданного Цикл
		Если списокИсключений.НайтиПоЗначению(мДокумент.Имя) <> Неопределено Тогда
			Продолжить;
		КонецЕсли;
		Если ПравоДоступа("Просмотр", мДокумент) Тогда
			лПараметры = Новый Структура("ИмяТеста,Транзакция,Параметр", имяТеста, Истина, мДокумент.Имя);
			ВсеТесты.Добавить(лПараметры);
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры

Процедура Тест_ОткрытьФормуСуществующегоДокумента(_ИДДокумента) Экспорт
	выборка = Документы[_ИДДокумента].Выбрать(,,, "Дата Убыв");
		юТест.ПроверитьИстину(выборка.Следующий(), "выборка.Следующий() - не найдено существующих документов! ");
	_док = выборка.ПолучитьОбъект();
	_Форма = _Док.ПолучитьФорму();
	
	_Форма.Открыть();
	юТест.Проверить(_Форма.Открыта(), "_Форма существующего документа """+_ИДДокумента+""" не открылась, а должна была открыться");
КонецПроцедуры

Процедура Тест_ПеренестиДокументНаТекущийДень_и_ОткрытьЕгоФорму(_ИДДокумента) Экспорт
	_Док = Документы[_ИДДокумента].СоздатьДокумент();
	_Док.Дата = ТекущаяДата();
	_Док.ОбменДанными.Загрузка = Истина;
	_Док.Записать();
	_Форма = _Док.ПолучитьФорму();
	
	_Форма.Открыть();
	юТест.Проверить(_Форма.Открыта(), "_Форма существующего документа """+_ИДДокумента+""" не открылась, а должна была открыться");
КонецПроцедуры

Процедура Тест_ОткрытьФормуНовогоДокумента(_ИДДокумента) Экспорт
	_Док = Документы[_ИДДокумента].СоздатьДокумент();
	_Форма = _Док.ПолучитьФорму();
	_Форма.Открыть();
	юТест.Проверить(_Форма.Открыта(), "_Форма нового документа """+_ИДДокумента+""" не открылась, а должна была открыться");
КонецПроцедуры

Функция ПолучитьСписокИсключений_Существующие()
	Результат = Новый СписокЗначений;
	
	Результат.Добавить("Цены");
	
	Возврат Результат;
КонецФункции

Функция ПолучитьСписокИсключений_ПеренестиДату()
	Результат = Новый СписокЗначений;
	
	Результат.Добавить("Цены");
	
	Возврат Результат;
КонецФункции

Функция ПолучитьСписокИсключений_Новые()
	Результат = Новый СписокЗначений;
	
	Результат.Добавить("Цены");
	
	Возврат Результат;
КонецФункции
